x = done, / = half done, ! = needs testing

## open tasks
[ ] [game] hand is not considered closed when winning on ron (agari should not produce an open meld)
[ ] [game] riichi is deducted from payer on ron
[ ] [game] riichi-with tile can be tsumogiri
[ ] [elm/game] waiting-for info should be encoded to the gamestate instead of events; now player can discard his shout options by refreshing
[ ] [elm/game] display uradora on win. They're in roundstate .flags when someone has won (or at least, should be)
[ ] [elm/game] uradorat ei toimi? näytä ura-indikaattorit pelin lopussa
[ ] [elm/game] new dora are not updated from server? at least, not displayed in elm without a refresh. see the flipped-dora event.
[ ] [elm] on tsumo, agari is not displayed at all. it is in hand-picks and those are not displayed atm
[ ] [elm] add clickables via elm-html. That is, tiles in hand and shouts. The Graphics.Input.clickable has major problems with at least android tablets
[ ] [elm] restyle kyoku results and final points views. they're crappy at best.  Perhaps should fit into the info block in the center? and the winning hand(s) could be displayed as the hand of the winning player(s).
[!] [elm] should discard the hovered/shout-indicator hovers after they're no longer relevant (bugs at leat mobile devices). Would discarding them after turn changes be enough?
[ ] [elm] after a game has ended (final points shown), make it possible to go back to lobby.
[ ] [gameserver] reloading when kyoku has ended and is in waiting state, goes to lobby; then should send the roundstate immediately instead of waiting for the threadDelay finish.
[ ] [site/gameserver] https
[ ] [site] add favicon
[ ] [other] go through the TODO's in the code. If a note is relevant create an issue for it in gh and annotate the todo with issue number

[x] riichi-nappula liian iso
[x] Set up logging to file in hajong-server
[x] huudettu tiili näkyy väärällä puolella mentsussa, aina?
[x] aka ei aina poistu kädestä huudon yhteydessä?
[x] [Error] Game 128 errored! unsafeRoundM: unexpected Left: Hand state was DrawNone, but expected DrawFromWanpai @(hajon_58UM7JvDhFX6fY2cDWnlc6:Hajong.Server src/Hajong/Server.hs:238:21)
[x] homepage: move aside up in mobile view
[x] when third player joins he may get the place of second player; possibly second player had left and reconnected only after third player joined
[x] setup sending email: support and auth-account
[x] Rework lobby: better listing of user names perhaps with facebook profile pics / gravatars
[x] refactoring: split H.Server to H.{Server.State,Server.Internal,Database,Database.Query} modules
[x] shouminkan jää näkyviin, kun huutaa ponin

# mechanics
[x] add test: riichi score is transferred on ron
[x] add test: honba are added to payments
[x] add test: riichi points on table are transferred on win
[x] add test: in sanankou, the third must not be completed by discard
[x] test and implement chankan
[x] implement the yakumans tenhou and renhou. tests are done
[x] add test: ankan in riichi
[x] add test: dora and ura-dora counted on win
[x] add test: dora is flipped on kantsu meld
[x] add test: cannot win with a hand without yaku. Not even if there are dora or ura-dora.
[x] add test: suufonrenda: four consecutive wind discards
[x] add test: suucha riichi: four players riichi. last discard may be called ron on
[x] add test: suukaikan: four kantsu called, all not by one player.
[x] Implement the suukantsu yaku. Add tests. When one player calls the fourth, game must not end.
[x] add test: 13 orphans can be ron from an ankan
[x] implement: A player is not considered tenpai if he is waiting only for a tile of which he already has 4
[x] add test: kazoe yakuman
[x] add test: double ron
[x] add tests for the yakumans
[x] implement aka-dora
[x] add test: aka-dora are yielded as extrayaku
[x] add test: when a ron/chankan shout isn't possible due to furiten/0 yaku or otherwise, someone can still go for a kan/pon/chi on the tile. (The invalid ron should not be present in the kyoku state machine in the first place.)
[x] Show-instance for tiles: add ""; also Read
[x] add test: aka-dora are calculated from a called mentsu
[x] add test: kokushi furiten
[x] add test: chiitoi furiten
[x] shouting a aka-dora results in all tiles of the mentsu be aka-dora
# client
[x] sending messages
[x] interface for viewing different kyoku states
[x] Highlight corresponding tiles on shout hovers
[x] Display hands of tenpai players on ryuukyoku
[x] when a call is passed, update callable info to client. client should not show it
[x] Display winning hand
[x] agari-call deserialization has changed (agarichankan removed)
[x] Display concealed hands of other players
[x] display aka-dora as red
# site
[x] In the settings page, encourage making feature requests via the support form
[x] Rework authentication system. *Email-based*. Include facebook etc. and gravatar.
[x] test facebook authentication
[x] report bug button: game UUID
[x] The yesod binary doesn't reconnect to hajong-server automatically. Make it shut down on disconnect.


# someday/maybe
[ ] refactoring: replace the StateT in kyoku code with a custom mechanism, which updates the kyoku state right after an event is triggered
[ ] add tests: riichi-transfers on multi-ron
[ ] make csrf middleware work with LogoutR too, so it can be enabled
[ ] Save game results to relational database
[ ] inspect test failure:
      TileGroupings of tiles of 'tileGroup' .<-- [ tileGroup ]:                    FAIL (0.34s)
              *** Gave up! Passed only 98 tests.
[ ] refactor the kyoku code: make it possible to only modify the state via events; the event should take effect in the StateT data immediately after 'telling' it
[ ] add test: kuushuu kyuuhai: 9 different honors or terminals on initial draw
[ ] when discarding "valid" shout options for furiten/no yaku, instead of discarding add them to a not-allowed record and if someone attempts to call them, emit corresponding error message. This eases debugging in the future. 
[ ] (graphics) point sticks (1000 done)
[ ] (graphics) more esthetic tiles
[ ] (elm) chat/dialog
[ ] (elm) try out elm-bridge for generating json parsers
[ ] (docs) write json API Spec
[ ] (site, elm) player last.fm integration
[ ] (site) Optional mic communication via webrtc
[ ] Game configuration options
   [ ] (opt) start and goal scores
   [ ] (opt) wareme
   [ ] (opt) chombo
   [ ] (opt) aotenjou
   [ ] (opt) basengo
   [ ] (opt) chombo
[ ] implement chiihou. which variants?
[ ] Pause a worker.
[ ] ryanhan-shibari
[ ] (worker/game) available shouts when refreshing game
[ ] sanchahou: disallow triple ron
[ ] client: automatic discard/action rules

# done
[x] (game, elm) riichi
[x] (game) kokushi musou
[x] (game) chiitoi
[x] (elm) riichi rotate tile
[x] (elm) riichi stick
[X] (game) BUG shoutedFrom cannot draw anymore "Cannot draw from wall"
[x] (game) BUG shouting multiple: discard player's all other shouts.
[X] (game) BUG draw; round changes even if oja is tenpai or no-one is tenpai
[x] (web) re-enter game on refresh
[x] (web) retain nick on refresh
[x] player in turn -indicator
[x] mentsu (needs correct from indicator)
[x] (game, elm) new dora when kan
[x] (elm) limit log lengths
[x] (game) furiten
[x] (site) nick set
[x] (game) nagashi mangan check
[x] (game) chankan
[!] (game) final scoring and possible next rounds
[!] (game) shout only ron on last tile from wall
[!] (game) no wait-shout other than ron if riichi
[!] (game) BUG: riichi even if hand open
[!] (game, elm, server) tsumo
[!] minshoukan
[!] ankan


# changes
[x] in Kyoku-type: pPlayers changed to index with kaze, not player. change in client
[x] flipped argument order in DealNick, change in JSON on  both sides
[x] in gamePoints, player changed to Kaze
[x] Kyoku._pRound : Kaze -> (Kaze, Int)
[x] in KyokuResults, Players are now Kaze
[x] Kyoku._pDeal removed
